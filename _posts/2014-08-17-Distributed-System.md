---
layout: post
title: Distributed System
tags: MapReduce distributed
categories: Linux
---

随着需求的增多，数据量增大，单机脚本无法满足需求，所以需要做成一个分布式系统。

Q1.系统设计
----------
* * *
* * *

参考MapReduce的设计思想，

###将应用逻辑和存储分离

1. 让应用服务器（CPU）和文件服务器（磁盘容量）各司其职。这样随着数据量的不断增大，系统能够很好的横向扩展。同时也提高了系统的可用性。
2. 使用分布式文件系统提高海量文件存储性能。

###利用集群解决高并发

1. 并行： 将输入数据集均匀分割为M个片段，获取url文本内容的Script因此也分到多台机器上并行处理，实现了并行下载。相应的单词统计Script也分到多台机器上并行处理。
2. 非阻塞： 在获取url文本时，设置Script的timeout，让脚本跳过超时，403Forbidden等访问失败的错误。允许单词统计的脚本跳过损坏的记录。

###降低耦合，利用消息机制将调用异步化

1. 使用分布式消息队列将调用异步化，可改善系统的扩展性
2. 对于**把文本转换为音频文件**的CPU-bound型，在文本下载完毕后，系统将请求**把文本转换为音频文件**发送给消息队列后立即返回，再由消费者进程异步获取消息，在合适的时候进行**文本转换**。

###容错

1. 对于具体需求，**系统需要把结果通过邮件附件发送给某个邮箱**，全局记录邮件发送日志，让系统周期性检测是否返回邮件发送失败信息，如果，邮件发送失败，系统重新触发该邮件的发送。
2. 对于Worker，Master周期性Ping每个Worker维持心跳，约定时间内没收到返回信息则将Worker标为失效。
3. 对于Master，一个简单的方法为Master周期性将上面的数据结构落地，即检查点CheckPoint。如果Master挂了可用CheckPoint启动另一Master。

###超时设置：请求设置超时时间，防止请求得不到响应还占用应用程序资源

###冗余

好像该系统没必要。
1. 时间冗余： 让Worker重复执行或者增大timeout
2. 信息冗余： 在要传递的消息中注入hamming码等冗余保证消息可靠
3. 物理冗余


Q2.系统可用性
------------
* * *
* * *

TODO

